"""
Copyright (C) J Leadbetter <j@jleadbetter.com>
Affero GPL v3
"""

import uuid
from typing import List, Optional

from pydantic import BaseModel, validator

from ..utils.languages import LanguageCode
from .base import HashableMixin
from .sentences import SentenceDB, SentenceUI
from .users import UserUI


class DocumentDB(HashableMixin, BaseModel):
    """
    Representation of a document to be stored in the database
    """

    id: Optional[uuid.UUID] = None  # Generated by the database when created.
    user_id: uuid.UUID  # UserProfile uuid
    display_name: str
    language_code: LanguageCode
    author: Optional[str] = None
    sentences: Optional[List[SentenceDB]] = []

    class Config:
        exclude_defaults = True
        use_enum_values = True

    @property
    def unique_fields(self):
        return ['user_id', 'display_name', 'language_code']


class DocumentUI(HashableMixin, BaseModel):
    """
    Full document for display in the UI
    """

    id: uuid.UUID
    user: UserUI
    author: Optional[str] = None
    displayName: str
    language: str
    sentences: List[SentenceUI]
